(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function E(){let c=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",c+"px")}window.addEventListener("DOMContentLoaded",E);window.addEventListener("resize",E);window.addEventListener("orientationchange",E);class q{constructor(e,t,d,n,o,a,r,h,i,y,p,f,u,x,k,m,v,S,j){this.flockSize=e,this.minSpeed=t,this.maxSpeed=d,this.width=n,this.height=o,this.seperation=a,this.seperationFactor=r,this.alignment=h,this.cohesion=i,this.bias=y,this.variance=p,this.turnFactor=f,this.raceCount=u,this.shape=x,this.agents=[],this.iterator=void 0,this.box_x=k,this.box_y=m,this.wrap=v,this.nearbyBool=S,this.closeBool=j}Start(){let e=[];for(let t=0;t<this.raceCount;t++){let d=Math.floor(Math.random()*255),n=Math.floor(Math.random()*255),o=Math.floor(Math.random()*255),a=[d,n,o];e.push(a)}this.agents.length=0;for(let t=0;t<this.flockSize;t++){let d=Math.floor(Math.random()*this.width),n=Math.floor(Math.random()*this.height),o=Math.max(this.minSpeed,Math.random()*this.maxSpeed),a=Math.max(this.minSpeed,Math.random()*this.maxSpeed);Math.random()>.5&&(o=-o),Math.random()>.5&&(a=-a);let r=this.seperation;if(this.variance>0){let f=parseFloat(document.getElementById("flockRangeSeperation").min),u=parseFloat(document.getElementById("flockRangeSeperation").max),k=(u-f)/100*this.variance,m=Math.floor(Math.random()*(k*1e3))/1e3;Math.random()>.5?r-=m:r+=m,r<f&&(r=f),r>u&&(r=u)}r=r.toFixed(5);let h=this.alignment;if(this.variance>0){let f=parseFloat(document.getElementById("flockRangeAlignment").min),u=parseFloat(document.getElementById("flockRangeAlignment").max),k=(u-f)/100*this.variance,m=Math.floor(Math.random()*(k*1e3))/1e3;Math.random()>.5?h-=m:h+=m,h<f&&(h=f),h>u&&(h=u)}h=h.toFixed(5);let i=this.cohesion;if(this.variance>0){let f=parseFloat(document.getElementById("flockRangeCohesion").min),u=parseFloat(document.getElementById("flockRangeCohesion").max),k=(u-f)/100*this.variance,m=Math.floor(Math.random()*(k*1e3))/1e3;Math.random()>.5?i-=m:i+=m,i<f&&(i=f),i>u&&(i=u)}i=i.toFixed(5);let y=Math.floor(Math.random()*e.length),p=new G(t,r,h,i,120,40,"Agent "+t,5,d,n,o,a,e[y]);this.agents.push(p)}this.Update(),this.DrawFlock(this.shape)}Iterate(){clearInterval(this.iterator),this.iterator=setInterval(()=>{this.Update()},8)}Pause(){clearInterval(this.iterator),this.iterator=null}Toggle(){this.iterator===null||this.iterator===void 0?this.Iterate():this.Pause()}Update(){let e=this.agents.length;for(let t=0;t<this.agents.length;t++)this.agents[t].outBox=!1,this.GetNearbyAgents(this.agents[t],e),this.Adjust(this.agents[t]),this.DetectEdgeCollisions(this.agents[t]),this.MovePosition(this.agents[t]);this.DrawFlock(this.shape)}GetNearbyAgents(e,t){if(e.x<0||e.x>this.width||e.y<0||e.y>this.height)return;let d=[],n=[],o=[],a=[],r=e.vision,h=e.closeVision;for(let i=0;i<t;i++){if(i==e.index)continue;let y=Math.abs(e.x-this.agents[i].x),p=Math.abs(e.y-this.agents[i].y);y<r&&p<r&&(d.push(i),e.colour===this.agents[i].colour&&o.push(i),y<h&&p<h&&(n.push(i),e.colour===this.agents[i].colour&&a.push(i)))}e.nearby=d,e.close=n,e.nearbyBias=o,e.closeBias=a}Adjust(e){if(e.nearby.length===0)return;let t=0,d=0;if(e.close.length>0){let n=0,o=0;for(let a=0;a<e.close.length;a++){let r=e.x-this.agents[e.close[a]].x,h=e.y-this.agents[e.close[a]].y;n+=this.seperationFactor/r,o+=this.seperationFactor/h}t+=n*this.seperation,d+=o*this.seperation}{let n=0,o=0,a=0;for(let i=0;i<e.nearby.length;i++)this.bias>0?e.colour===this.agents[e.nearby[i]].colour?(n+=this.agents[e.nearby[i]].vx,o+=this.agents[e.nearby[i]].vy,a++):(n+=this.agents[e.nearby[i]].vx/this.bias,o+=this.agents[e.nearby[i]].vy/this.bias,a+=1/this.bias):(n+=this.agents[e.nearby[i]].vx,o+=this.agents[e.nearby[i]].vy);let r,h;this.bias>0?(r=n/a,h=o/a):(r=n/e.nearby.length,h=o/e.nearby.length),t+=(r-e.vx)*this.alignment,d+=(h-e.vy)*this.alignment}{let n=0,o=0,a=0;for(let i=0;i<e.nearby.length;i++)this.bias>0?e.colour===this.agents[e.nearby[i]].colour?(n+=this.agents[e.nearby[i]].x,o+=this.agents[e.nearby[i]].y,a++):(n+=this.agents[e.nearby[i]].x/this.bias,o+=this.agents[e.nearby[i]].y/this.bias,a+=1/this.bias):(n+=this.agents[e.nearby[i]].x,o+=this.agents[e.nearby[i]].y);let r,h;this.bias>0?(r=n/a,h=o/a):(r=n/e.nearby.length,h=o/e.nearby.length),t+=(r-e.x)*this.cohesion,d+=(h-e.y)*this.cohesion}e.vx+=t,e.vy+=d}DetectEdgeCollisions(e){e.x<e.radius+this.box_x?this.wrap?e.x=this.width-e.radius-this.box_x:(e.vx+=this.turnFactor,e.outBox=!0):e.x>this.width-e.radius-this.box_x&&(this.wrap?e.x=e.radius+this.box_x:(e.vx-=this.turnFactor,e.outBox=!0)),e.y<e.radius+this.box_y?this.wrap?e.y=this.height-e.radius-this.box_y:(e.vy+=this.turnFactor,e.outBox=!0):e.y>this.height-e.radius-this.box_y&&(this.wrap?e.y=e.radius+this.box_y:(e.vy-=this.turnFactor,e.outBox=!0))}MovePosition(e){let t=Math.sqrt(e.vx*e.vx+e.vy*e.vy);t>this.maxSpeed&&(e.vx=e.vx/t*this.maxSpeed,e.vy=e.vy/t*this.maxSpeed),t<this.minSpeed&&(e.vx=e.vx/t*this.minSpeed,e.vy=e.vx/t*this.minSpeed),e.x+=e.vx,e.y+=e.vy}DrawFlock(e){s.clearRect(0,0,this.width,this.height),s.strokeStyle="#d1d5db",s.beginPath(),s.rect(this.box_x,this.box_y,this.width-this.box_x*2,this.height-this.box_y*2),s.stroke();for(let t=0;t<this.agents.length;t++){if(e==="line"){s.lineWidth=this.agents[t].radius/3;let d=this.agents[t].vx*this.agents[t].radius,n=this.agents[t].vy*this.agents[t].radius;s.strokeStyle!=this.agents[t].colour&&(s.strokeStyle=this.agents[t].colour),s.beginPath(),s.moveTo(this.agents[t].x,this.agents[t].y),s.lineTo(this.agents[t].x+d,this.agents[t].y+n),s.stroke()}else e==="circle"&&(s.fillStyle!=this.agents[t].colour&&(s.fillStyle=this.agents[t].colour),s.beginPath(),s.arc(this.agents[t].x,this.agents[t].y,this.agents[t].radius,0,2*Math.PI),s.fill());this.nearbyBool&&(s.strokeStyle="green",s.beginPath(),s.rect(this.agents[t].x-this.agents[t].vision/2,this.agents[t].y-this.agents[t].vision/2,this.agents[t].vision,this.agents[t].vision),s.stroke(),s.fillStyle="green",s.fillText(this.agents[t].nearby.length,this.agents[t].x+7.5,this.agents[t].y+5)),this.closeBool&&(s.strokeStyle="red",s.beginPath(),s.rect(this.agents[t].x-this.agents[t].closeVision/2,this.agents[t].y-this.agents[t].closeVision/2,this.agents[t].closeVision,this.agents[t].closeVision),s.stroke(),s.fillStyle="red",s.fillText(this.agents[t].close.length,this.agents[t].x+7.5,this.agents[t].y-5));{s.strokeStyle=this.agents[t].colour,s.beginPath();let d=this.agents[t].vx*this.agents[t].radius,n=this.agents[t].vy*this.agents[t].radius;s.moveTo(this.agents[t].x,this.agents[t].y),s.lineTo(this.agents[t].x+this.agents[t].vx+d,this.agents[t].y+this.agents[t].vy+n),s.stroke()}}}}class G{constructor(e,t,d,n,o,a,r,h,i,y,p,f,u){this.index=e,this.seperation=t,this.avoidance=d,this.cohesion=n,this.vision=o,this.closeVision=a,this.name=r,this.radius=h,this.x=i,this.y=y,this.vx=p,this.vy=f,this.colour="rgba("+u[0]+","+u[1]+","+u[2]+", 1)",this.nearby=[],this.close=[],this.nearbyBias=[],this.closeBias=[]}}const K=document.getElementById("startButton");K.onclick=function(){me()};document.getElementById("playPauseButton");const J=document.getElementById("nextButton");J.onclick=function(){l.Pause(),l.Update()};const Q=document.getElementById("optionsButton");Q.onclick=function(){ge()};const b=document.getElementById("settingsMenu"),Z=document.getElementById("flockSizeInput"),R=document.getElementById("flockSizeRange");R.onchange=function(){g(1,R.value,Z)};const $=document.getElementById("flockSizeShapeLine");$.onclick=function(){w()};const ee=document.getElementById("flockSizeShapeCircle");ee.onclick=function(){w()};const te=document.getElementById("flockInputMinSpeed"),M=document.getElementById("flockRangeMinSpeed");M.onchange=function(){g(2,M.value,te)};const ne=document.getElementById("flockInputMaxSpeed"),F=document.getElementById("flockRangeMaxSpeed");F.onchange=function(){g(3,F.value,ne)};const ie=document.getElementById("flockInputSeperation"),C=document.getElementById("flockRangeSeperation");C.onchange=function(){g(4,C.value,ie)};const oe=document.getElementById("flockInputSeperationFactor"),P=document.getElementById("flockRangeSeperationFactor");P.onchange=function(){g(5,P.value,oe)};const se=document.getElementById("flockInputAlignment"),T=document.getElementById("flockRangeAlignment");T.onchange=function(){g(6,T.value,se)};const le=document.getElementById("flockInputCohesion"),z=document.getElementById("flockRangeCohesion");z.onchange=function(){g(7,z.value,le)};const ae=document.getElementById("flockInputTurn"),V=document.getElementById("flockRangeTurn");V.onchange=function(){g(9,V.value,ae)};const ce=document.getElementById("flockInputTribes"),_=document.getElementById("flockRangeTribes");_.onchange=function(){g(10,_.value,ce)};const re=document.getElementById("flockInputBias"),A=document.getElementById("flockRangeBias");A.onchange=function(){g(8,A.value,re)};const he=document.getElementById("flockRangeVarianceText"),D=document.getElementById("flockRangeVariance");D.onchange=function(){g(16,D.value,he)};const de=document.getElementById("flockInputBoxX"),L=document.getElementById("flockRangeBoxX");L.onchange=function(){g(11,L.value,de)};const ue=document.getElementById("flockInputBoxY"),X=document.getElementById("flockRangeBoxY");X.onchange=function(){g(12,X.value,ue)};const Y=document.getElementById("flockWrap");Y.onchange=function(){g(13,Y.checked)};const W=document.getElementById("flockNearby");W.onchange=function(){g(14,W.checked)};const H=document.getElementById("flockClose");H.onchange=function(){g(15,H.checked)};const fe=document.getElementById("generateButton");fe.onclick=function(){O()};const B=document.getElementById("gameContainer"),N=document.getElementById("gameDiv"),I=document.getElementById("gameCanvas"),s=I.getContext("2d");let l=null;function O(){U();let c=parseInt(I.width),e=parseInt(I.height);l!==null&&l.Pause();let t=w(),d=parseInt(document.getElementById("flockSizeRange").value),n=parseInt(document.getElementById("flockRangeMinSpeed").value),o=parseInt(document.getElementById("flockRangeMaxSpeed").value),a=parseFloat(document.getElementById("flockRangeSeperation").value),r=parseFloat(document.getElementById("flockRangeSeperationFactor").value),h=parseFloat(document.getElementById("flockRangeAlignment").value),i=parseFloat(document.getElementById("flockRangeCohesion").value),y=parseFloat(document.getElementById("flockRangeBias").value),p=parseFloat(document.getElementById("flockRangeVariance").value),f=parseFloat(document.getElementById("flockRangeTurn").value),u=parseInt(document.getElementById("flockRangeTribes").value),x=parseFloat(document.getElementById("flockRangeBoxX").value),k=parseInt(document.getElementById("flockRangeBoxY").value),m=document.getElementById("flockWrap").checked,v=document.getElementById("flockNearby").checked,S=document.getElementById("flockClose").checked;l=new q(d,n,o,c,e,a,r,h,i,y,p,f,u,t,x,k,m,v,S),l.Start(),b.style.display="none"}function ge(){b.style.display===""?b.style.display="none":b.style.display=""}function me(){l.Toggle()}function U(){B.width=window.innerWidth,B.height=window.innerHeight*.9,N.width=window.innerWidth,N.height=window.innerHeight*.9,I.width=window.innerWidth,I.height=window.innerHeight*.9,s.width=window.innerWidth,s.height=window.innerHeight*.9,l!=null&&(l.width=B.scrollWidth,l.height=B.scrollHeight,l.DrawFlock(l.shape))}function w(){let c=document.getElementById("flockSizeShapeCircle"),e="line";return c.checked===!0&&(e="circle"),l!==null&&(l.shape=e),e}function g(c,e,t){t!==void 0&&e!==void 0&&(t.value=e),c===1&&(l.flockSize=parseInt(e)),c===2&&(l.minSpeed=parseInt(e)),c===3&&(l.maxSpeed=parseInt(e)),c===4&&(l.seperation=parseFloat(e)),c===5&&(l.seperationFactor=parseFloat(e)),c===6&&(l.alignment=parseFloat(e)),c===7&&(l.cohesion=parseFloat(e)),c===8&&(l.bias=parseFloat(e)),c===9&&(l.turnFactor=parseFloat(e)),c===10&&(l.raceCount=parseInt(e)),c===11&&(l.box_x=parseInt(e)),c===12&&(l.box_y=parseInt(e)),c===13&&(l.wrap=e),c===14&&(l.nearbyBool=e),c===15&&(l.closeBool=e),c===15&&(l.closeBool=e),c===16&&(l.variance=e)}document.onkeydown=function(c){c.key=="u"&&l.Update(),c.key=="p"&&l.Pause(),c.key=="i"&&l.Iterate()};window.addEventListener("resize",U);document.addEventListener("DOMContentLoaded",O);
